{% extends 'hub/base.html' %}

{% load humanize %}
{% load hub_filters %}

{% block content %}

<div class="py-4 py-lg-5">
    <div class="container">
        <h1 class="m-0">{{ area.name }}</h1>
        {% if area_tags %}
        <ul class="list-inline mt-3 mb-0">
          {% for tag in area_tags %}
            {% include "hub/area/_tag.html" with colour=tag.colour title=tag.title name=tag.name key=tag.key value=tag.value only %}
          {% endfor %}
        </ul>
        {% endif %}
    </div>
</div>

<div class="py-4 py-lg-5 bg-light">
    <div class="container mb-5">

        <div class="row">
            <div class="col-lg-3 col-xl-2 mb-4 mb-lg-0 bg-light area-subnav">
                <div>
                    <nav class="nav flex-lg-column">
                        <a class="nav-link" href="#mp">MP</a>
                      {% if categories.opinion %}
                        <a class="nav-link" href="#opinion">Public opinion</a>
                      {% endif %}
                      {% if categories.place %}
                        <a class="nav-link" href="#place">Place</a>
                      {% endif %}
                      {% if categories.movement %}
                        <a class="nav-link" href="#movement">Movement</a>
                      {% endif %}
                    </nav>
                </div>
            </div>
            <div class="col-lg-9 offset-xl-1">

                <section id="mp" class="area-section">
                    <h2 class="mb-3 text-primary">MP</h2>
                    {% include 'hub/area/_mp_data.html' with mp_data=mp %}
                </section>

              {% if categories.opinion %}
                <section id="opinion" class="area-section">
                    <h2 class="mb-3 text-primary">Public opinion</h2>

                    <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
                        <div class="col d-flex flex-column">

                            {% include 'hub/area/_mrp_data.html' with dataset=indexed_categories.opinion.hnh_mrp_29 row_height=85 %}

                            {% include 'hub/area/_mrp_data.html' with dataset=indexed_categories.opinion.hnh_mrp_37_1 row_height=65 %}

                            {% include 'hub/area/_mrp_data.html' with dataset=indexed_categories.opinion.hnh_mrp_41_1 row_height=65 %}

                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header">
                                    <h5>Support for net zero</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table mb-0">
                                        <thead>
                                            <tr>
                                                <th scope="col">Opinion</th>
                                                <th scope="col">This area</th>
                                                <th scope="col" class="text-muted">UK average</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                          {% for datum in categories.opinion %}
                                            {% if datum.subcategory == "net_zero_support" %}
                                            <tr>
                                                <th>{{ datum.name | simplify_dataset_name }}</th>
                                                <td>{{ datum.data.value|floatformat }}%</td>
                                                <td class="text-muted">{{ datum.data.average|floatformat }}%</td>
                                            </tr>
                                            {% endif %}
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">Data from Public First, commissioned by Onward UK</a></p>
                                </div>
                            </div>
                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header pe-3">
                                    <h5>Consider climate change a high priority</h5>
                                </div>
                                <div class="card-body">
                                    <p class="card-text mb-0 display-6 lh-1 text-primary">{{ indexed_categories.opinion.constituency_cc_high.data.value|floatformat }}%</p>
                                    <p class="card-text mt-2 text-muted">{{ indexed_categories.opinion.constituency_cc_high.data.average|floatformat }}% national average</p>
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">Data from Public First, commissioned by Onward UK</a></p>
                                </div>
                            </div>
                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header pe-3">
                                    <h5>Vote share at last election</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table mb-0">
                                        <thead>
                                            <tr>
                                                <th scope="col">Party</th>
                                                <th scope="col">Votes</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for data in indexed_categories.opinion.last_election.data.value.results|dictsortreversed:"votes" %}
                                                {% if data.votes != 0 %}
                                                    <tr>
                                                        <th>{{ data.party }}</th>
                                                        <td>{{ data.votes }}</td>
                                                    </tr>
                                                {% endif %}
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">{{ indexed_categories.opinion.last_election.data.value.date|naturalday:"jS M Y" }} election results from UK Parliament</a></p>
                                </div>
                            </div>
                        </div>
                        <div class="col d-flex flex-column">

                            {% include 'hub/area/_mrp_data.html' with dataset=indexed_categories.opinion.hnh_mrp_24_3 row_height=65 %}

                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header pe-3">
                                    <h5>Support renewable energy projects in their local area</h5>
                                </div>
                                <div class="card-body">
                                    <p class="card-text mb-0 display-6 lh-1 text-primary">{{ indexed_categories.opinion.support_local_renewable.data.value|floatformat }}%</p>
                                    <p class="card-text mt-2 text-muted">{{ indexed_categories.opinion.support_local_renewable.data.average|floatformat }}% national average</p>
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">Data from Survation, commissioned by RenewableUK</a></p>
                                </div>
                            </div>
                            {% include 'hub/area/_opinion_table_data.html' with title="Renewable energy" col_name="Opinion" category=categories.opinion subcategory="renewable_energy" data_source="Data from Survation, commissioned by RenewableUK" %}
                            {% include 'hub/area/_opinion_table_data.html' with title="Cost of living" col_name="Question"  category=categories.opinion subcategory="cost_of_living" data_source="Data from Survation, commissioned by 38Degrees" %}


                            {% include 'hub/area/_mrp_data.html' with dataset=indexed_categories.opinion.hnh_mrp_25 row_height=65 %}
                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header pe-3">
                                    <h5>Voted to leave the European Union</h5>
                                </div>
                                <div class="card-body">
                                    <p class="card-text mb-0 display-6 lh-1 text-primary">{{ indexed_categories.opinion.brexit_votes.data.value|floatformat }}%</p>
                                    <p class="card-text mt-2 text-muted">{{ indexed_categories.opinion.brexit_votes.data.average|floatformat }}% national average</p>
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">Data from UK Parliament</a></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
                        <div class="col d-flex flex-column">
                                {% include 'hub/area/_opinion_table_data.html' with title="Voting" col_name="Opinion"  category=categories.opinion subcategory="voting" data_source="Data from Survation, commissioned by RenewableUK" %}
                        </div>
                        <div class="col d-flex flex-column">
                            {% include 'hub/area/_opinion_table_data.html' with title="Government Action" col_name="Opinion"  category=categories.opinion subcategory="government_action" data_source="Data from Survation, commissioned by RenewableUK" %}
                        </div>
                    </div>

                </section>
              {% elif debug %}
                <section id="opinion" class="area-section">
                    {% include 'hub/area/_no_data.html' with name="Public opinion" variable="opinion" %}
                </section>
              {% endif %}

              {% if categories.place %}
                <section id="place" class="area-section">
                    <h2 class="mb-3 text-primary">Place</h2>
                    <div class="row row-cols-1 row-cols-md-2 g-4">
                      {% for category in categories.place %}
                        {% include 'hub/area/_place_data.html' with category=category %}
                      {% endfor %}
                    </div>
                </section>
              {% elif debug %}
                <section id="place" class="area-section">
                    {% include 'hub/area/_no_data.html' with name="Place" variable="movement" %}
                </section>
              {% endif %}

              {% if categories.movement %}
                <section id="movement" class="area-section">
                    <h2 class="mb-3 text-primary">Movement</h2>

                    <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
                        <div class="col d-flex flex-column">
                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header">
                                    <h5>Supporters and activists</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table mb-0">
                                        <thead>
                                            <tr>
                                                <th scope="col">Organisation</th>
                                                <th scope="col">This area</th>
                                                <th scope="col" class="text-muted">UK average</th>
                                            </tr>
                                        </thead>
                                       <tbody>
                                          {% for datum in categories.movement %}
                                            {% if datum.subcategory == "supporters_and_activists" %}
                                            <tr>
                                                <th>{{ datum.name | simplify_dataset_name }}</th>
                                                <td>{{ datum.data.value|floatformat }}</td>
                                                <td class="text-muted">{{ datum.data.average|floatformat }}</td>
                                            </tr>
                                            {% endif %}
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">Data from members of The Climate Coalition</a></p>
                                </div>
                            </div>

                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header">
                                    <h5>Places and spaces</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table mb-0">
                                        <thead>
                                            <tr>
                                                <th scope="col">Organisation</th>
                                                <th scope="col">This area</th>
                                                <th scope="col" class="text-muted">UK average</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                          {% for datum in categories.movement %}
                                            {% if datum.subcategory == "places_and_spaces" %}
                                            <tr>
                                                <th>{{ datum.name | simplify_dataset_name }}</th>
                                                <td>{{ datum.data.value|floatformat }}</td>
                                                <td class="text-muted">{{ datum.data.average|floatformat }}</td>
                                            </tr>
                                            {% endif %}
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">Data from members of The Climate Coalition</a></p>
                                </div>
                            </div>
                        </div>

                        <div class="col d-flex flex-column">
                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header">
                                    <h5>Groups</h5>
                                </div>
                                <div class="card-body">
                                  {% for datum in categories.movement %}
                                  {% if datum.subcategory == "groups" %}
                                    <h6 class="text-muted fw-bold">{{ datum.label }}</h6>
                                    <ul class="tag-cloud">
                                      {% for data in datum.data.json %}
                                        {% if data.url %}
                                          <li><a href="{{ data.url }}" class="tag" title="{{ datum.label }}">{{ data.group_name }}</a></li>
                                        {% else %}
                                          <li class="tag">{{ data.group_name }}</li>
                                        {% endif %}
                                      {% endfor %}
                                    </ul>
                                  {% endif %}
                                  {% endfor %}
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">Data from members of The Climate Coalition</a></p>
                                </div>
                            </div>

                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header">
                                    <h5>Locations</h5>
                                </div>
                                <div class="card-body">
                                  {% for datum in categories.movement %}
                                  {% if datum.subcategory == "locations" %}
                                    <h6 class="text-muted fw-bold">{{ datum.label }}</h6>
                                    <ul class="tag-cloud">
                                      {% for data in datum.data.json %}
                                        <li><a href="{{ data.url }}" class="tag">{{ data.name }}</a></li>
                                      {% endfor %}
                                    </ul>
                                  {% endif %}
                                  {% endfor %}
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">Data from members of The Climate Coalition</a></p>
                                </div>
                            </div>

                            <div class="card flex-grow-1 dataset-card">
                                <div class="dataset-card-header">
                                    <h5>Events</h5>
                                </div>
                                <div class="card-body">
                                    <table class="table mb-0">
                                        <thead>
                                            <tr>
                                                <th scope="col">Organisation</th>
                                                <th scope="col">This area</th>
                                                <th scope="col" class="text-muted">UK average</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                          {% for datum in categories.movement %}
                                            {% if datum.subcategory == "events" %}
                                            <tr>
                                                <th>{{ datum.name | simplify_dataset_name }}</th>
                                                <td>{{ datum.data.value|floatformat }}</td>
                                                <td class="text-muted">{{ datum.data.average|floatformat }}</td>
                                            </tr>
                                            {% endif %}
                                          {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-footer bg-white">
                                    <p class="card-text fs-8"><a href="{% url 'sources' %}" class="text-decoration-none text-muted">Data from members of The Climate Coalition</a></p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--
                    <div class="row row-cols-1 row-cols-md-2 g-4">
                      {% for category in categories.movement %}
                        {% include 'hub/area/_place_data.html' with category=category %}
                      {% endfor %}
                    </div>
                    -->
                </section>
              {% elif debug %}
                <section id="movement" class="area-section">
                    {% include 'hub/area/_no_data.html' with name="Movement" variable="movement" %}
                </section>
              {% endif %}

                <!--
                <div class="mt-5 p-3 bg-white border rounded d-flex align-items-center">
                    {% include 'hub/includes/icons/tcc-heart.html' with width="1.25em" height="1.25em" classes="me-3 flex-shrink-0 flex-grow-0" %}
                    <p class="mb-0">
                        <strong class="me-2">TCC member?</strong> Log in or request an account to upload your own datasets and bookmark your favourite datasets for easy access.
                    </p>
                </div>
                -->

            </div>
        </div>

    </div>
</div>
{% endblock %}
